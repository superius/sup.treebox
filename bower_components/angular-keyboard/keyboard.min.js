"use strict";angular.module("keyboard.focus",[]),angular.module("keyboard",["keyboard.focus"]),angular.module("keyboard").constant("undefined"),angular.module("keyboard").factory("KbContainerController",["undefined","$log",function(e,t){function n(t){this.identifier="[kb-container]",this.ngModel=e,this.selected=[],this.multiple=!1,this.cyclic=!1,this.active=e,this._element=t[0]}return n.$inject=["$element"],angular.extend(n.prototype,{initialize:function(e){this.multiple=angular.isDefined(e.attrs.multiple),this.cyclic=angular.isDefined(e.attrs.kbCyclic),angular.extend(this,e),this.ngModel&&(this.ngModel.$render=function(){this.multiple?(this.selected=this.ngModel.$viewValue,angular.isArray(this.selected)===!1&&(angular.isDefined(this.selected)&&t.error(this.identifier,"ng-model(multiple) must be an array, got:",this.selected),this.selected=[])):this.selected[0]=this.ngModel.$viewValue;for(var e in this.selected){var n=this._locate(this.selected[e]);if(n){this.active=n;break}}}.bind(this))},select:function(e){this.ngModel&&(this.multiple?this.isSelected(e)===!1&&(this.selected.push(e),this.ngModel.$setViewValue(this.selected)):(this.selected[0]=e,this.ngModel.$setViewValue(e)))},deselect:function(t){if(this.ngModel){var n=this.selected.indexOf(t);-1!==n&&(this.selected.splice(n,1),this.ngModel.$setViewValue(this.multiple?this.selected:e))}},toggle:function(e){this.isSelected(e)?this.deselect(e):this.select(e)},isSelected:function(e){return-1!==this.selected.indexOf(e)},previous:function(){var e=this._getSiblingItems(this.active).previous;return e?(this.active=e,!0):!1},next:function(){var e=this._getSiblingItems(this.active).next;return e?(this.active=e,!0):!1},activate:function(){return t.$error(this.identifier,"activate() is not implemented"),!1},invoke:function(){return t.$error(this.identifier,"invoke() is not implemented"),!1},_locate:function(e){for(var t=this._element.querySelectorAll("[kb-item]"),n=0;n<t.length;n++){var i=angular.element(t.item(n)).controller("kbItem");if(i.model===e)return i}},_getSiblingItems:function(e){for(var t=e.element[0],n=this._element.querySelectorAll("[kb-item]"),i=0;i<n.length;i++){var o=n.item(i);if(o===t){var l={};return 0!==i&&(l.previous=angular.element(n.item(i-1)).controller("kbItem")),i<n.length-1&&(l.next=angular.element(n.item(i+1)).controller("kbItem")),l}}return{}},_first:function(){var e=this._element.querySelector("[kb-item]");return e?angular.element(e).controller("kbItem"):void 0},_last:function(){var e=this._element.querySelectorAll("[kb-item]");return e.length?angular.element(e[e.length-1]).controller("kbItem"):void 0}}),n}]),angular.module("keyboard").factory("KbItemController",["kbScroll","undefined",function(e,t){function n(e){this.model=t,this.element=e}return n.$inject=["$element"],n}]),angular.module("keyboard.focus").directive("kbFocus",["kbFocus","$log",function(){return function(e,t,n){e.$watch(n.kbAutofocus,function(e){t.prop("autofocus",!!e)})}}]),angular.module("keyboard.focus").directive("kbFocus",["kbFocus","$log",function(e,t){return function(n,i,o){n.$watch(e.get,function(e){e===o.kbFocus&&(""===e?t.error("[kb-focus] Invalid label in",i[0]):(i[0].focus(),document.activeElement!==i[0]&&setTimeout(function(){i[0].focus()})))}),i.on("focus",function(){e(o.kbFocus),n.$root.$$phase||n.$apply()}),i.on("blur",function(){e.get()===o.kbFocus&&(e.reset(),n.$root.$$phase||n.$apply())})}}]),angular.module("keyboard").directive("kbItem",["KbItemController","$animate","$log",function(e,t,n){return{controller:e,require:["kbItem","?^kbList","?^kbSelect"],link:function(e,i,o,l){function r(e,t,n){return"left"===e&&n.left<t.left?t.left-n.left:"up"===e&&n.top<t.top?t.top-n.top:"right"===e&&n.left>t.left?n.left-t.left:"down"===e&&n.top>t.top?n.top-t.top:0}for(var c=l[0],a=l[1],s="A"===i[0].tagName||"BUTTON"===i[0].tagName||"AREA"===i[0].tagName,u=1;u<l.length;u++)l[u]&&(a=l[u]);if(!a)return void n.error("Controller 'kbList' or 'kbSelect', required by directive 'kbItem', can't be found!");var f=o.kbSelectedClass||"kb-selected",d=o.kbActiveClass||"kb-active";c.model=e.$eval(o.kbItem),e.$watch(o.kbItem,function(e){c.model=e}),"undefined"==typeof a.active?a.active=c:a.isSelected(c.model)&&a.isSelected(a.active.model)===!1&&(a.active=c),e.$watch(function(){return a.isSelected(c.model)},function(e){e?t.addClass(i,f):t.removeClass(i,f)}),e.$watch(function(){return a.active===c},function(e){e?(i.attr("tabindex",0),t.addClass(i,d)):(t.removeClass(i,d),s?i.attr("tabindex",-1):i.removeAttr("tabindex"))});var h={37:"left",38:"up",39:"right",40:"down"};i.on("keydown",function(t){var n=!1,l=!1;if(t.which>=37&&t.which<=40){var s=a._getSiblingItems(c),u=i[0].getBoundingClientRect();if(s.previous&&r(h[t.which],u,s.previous.element[0].getBoundingClientRect())&&(a.activate(s.previous),n=!0),s.next&&r(h[t.which],u,s.next.element[0].getBoundingClientRect())&&(a.activate(s.next),n=!0),!(n!==!1||s.next&&s.previous)){var f=t.which,d=!1;t.which<=38?f+=2:f-=2,s.next&&r(h[f],u,s.next.element[0].getBoundingClientRect())&&(a.cyclic?(a.activate(a._last()),n=!0):d="kbReachedBegin"),s.previous&&r(h[f],u,s.previous.element[0].getBoundingClientRect())&&(a.cyclic?(a.activate(a._first()),n=!0):d="kbReachedEnd"),d&&a.attrs[d]&&angular.element(a._element).scope().$eval(a.attrs[d],{$event:t})}}else(32===t.which||13===t.which)&&(l=!0);(n||l)&&(t.preventDefault(),l&&(a.invoke(c),o.kbInvoke&&e.$eval(o.kbInvoke,{$event:t})),e.$apply())}),i.on("click",function(t){a.activate(c),a.invoke(c),o.kbInvoke&&e.$eval(o.kbInvoke,{$event:t}),e.$apply()}),e.$on("$destroy",function(){a.active=a._first()})}}}]),angular.module("keyboard").directive("kbList",["KbContainerController","kbScroll",function(e,t){return{controller:e,require:["kbList","?ngModel"],link:function(e,n,i,o){var l=o[0];l.initialize({identifier:"[kb-list]",ngModel:o[1],attrs:i,activate:function(e){this.active=e,this.select(e.model),t.focus(e.element[0])},invoke:function(){return!1}})}}}]),angular.module("keyboard").directive("kbSelect",["KbContainerController","kbScroll",function(e,t){return{controller:e,require:["kbSelect","ngModel"],link:function(e,n,i,o){var l=o[0];l.initialize({identifier:"[kb-select]",ngModel:o[1],attrs:i,activate:function(e){this.active=e,t.focus(e.element[0])},invoke:function(e){return this.toggle(e.model),!0}})}}}]),angular.module("keyboard.focus").factory("kbFocus",["$log",function(e){var t="",n=function(e){return 0===arguments.length?t:void n.set(e)};return n.get=function(){return t},n.set=function(n){"string"==typeof n?t=n:e.error("[kbFocus] label must be a string, got",n)},n.reset=function(){t=""},n}]),angular.module("keyboard").service("kbScroll",["$window",function(e){var t="BODY";navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(t="HTML");var n=this;this.change=function(e,t,n,i){if(i&&angular.element.prototype.animate){var o=angular.element(e),l={};return l[t]=n,o.animate(l,i),function(){o.stop(!0,!0)}}return e[t]=n,angular.noop},this.getScrollParent=function(e){for(var n=e.parentElement;n.nodeName!==t;){var i=getComputedStyle(n),o=i.overflow+i.overflowX+i.overflowY;if(o.match(/scroll|hidden/))break;n=n.parentElement}return n},this.to=function(i,o,l){var r=angular.noop,c=n.getScrollParent(i),a=i.getBoundingClientRect(),s={top:Math.ceil(a.top),right:Math.ceil(a.right),bottom:Math.ceil(a.bottom),left:Math.ceil(a.left)};if(c.nodeName===t)var u={top:0,right:e.innerWidth,bottom:e.innerHeight,left:0};else var f=c.getBoundingClientRect(),u={top:Math.ceil(f.top),right:Math.ceil(f.right),bottom:Math.ceil(f.bottom),left:Math.ceil(f.left)};var d=s.top-u.top,h=u.right-s.right,g=u.bottom-s.bottom,m=s.left-u.left;if(d+o.top<0?(r=n.change(c,"scrollTop",c.scrollTop+d+o.top,l),g+=d,d=0):g+o.bottom<0&&(r=n.change(c,"scrollTop",c.scrollTop-g+o.bottom,l),d+=g,g=0),m+o.left<0?(r=n.change(c,"scrollLeft",c.scrollLeft+m+o.left,l),h+=m,m=0):h+o.right<0&&(r=n.change(c,"scrollLeft",c.scrollLeft-h+o.right,l),m+=h,h=0),c.nodeName===t)return r;var v=n.to(c,{top:d,right:d,bottom:g,left:m},l);return function(){r(),v()}};var i=angular.noop;this.focus=function(e){i();var t=this.getScrollParent(e),n={top:t.scrollTop,left:t.scrollLeft};e.hasAttribute("tabindex")||e.setAttribute("tabindex",0),e.focus(),(t.scrollTop!==n.top||t.scrollLeft!==n.left)&&(t.scrollTop=n.top,t.scrollLeft=n.left,i=this.to(e,{top:0,right:0,bottom:0,left:0},200))}}]);
//# sourceMappingURL=keyboard.min.js.map